<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>HTML5-Snake</title>
    <meta name="description" content="Demo of the HTML5 version of the classic game: Snake">
    <style>
        /* CSS for HTML5-Snake v1.0.0 */

        #snake {
            border: 1px solid black;
            background-color: whitesmoke;
        }
    </style>
</head>

<body>
    <h1>HTML5-Snake</h1>
    <canvas id="snake" width="600px" height="600px"></canvas>
    <div id="controls">
        <button id="start" onclick="start()">Start</button>
        <label>Score: </label>
        <span id="score">0</span>
    </div>
    <script type="text/javascript">
        /**
         * HTML5-Snake v1.0.0
         * This is a HTML5 version of the classic game: Snake
         *
         * @author      Christopher Viray
         * @copyright   (c) 2018 Christopher Viray
         * @license     MIT
         * @version     1.0.0
         */

        // variables
        var canvas = document.getElementById('snake');
        var context = canvas.getContext('2d');
        var boardWidth = 600;
        var boardHeight = 600;
        var squareWidth = 30;
        var squareHeight = 30;
        var snake = [];
        var food = { 'x': null, 'y': null };
        var direction = null;
        var score = 0;
        var gameover = false;
        var loop = null;

        // function to setup and start the game
        function start() {
            init();
            clearBoard();
            createFood();
            addToSnake((boardWidth / 2), (boardHeight / 2)); // setup snake in middle
            document.onkeydown = this.checkForArrowKeys; // add listener for arrow keys
            loop = setInterval(runGameLoop, 100); // run game loop
        }

        // function to initialize the default values for the game
        function init() {
            // reset values
            snake = [];
            food = { 'x': null, 'y': null };
            direction = 'right'; // default direction
            score = 0;
            gameover = false;
            clearInterval(loop);
        }

        // function to setup board layout
        function clearBoard() {
            context.clearRect(0, 0, boardWidth, boardHeight); // reset
        }

        // function to draw a single square on the board
        function drawSquare(x, y, color) {
            context.beginPath();
            context.rect(x, y, (squareWidth - 1), (squareHeight - 1));
            context.fillStyle = color;
            context.fill();
            context.lineWidth = 1;
            context.strokeStyle = 'black';
            context.stroke();
        }

        // function to randomly create a food square on the board
        function createFood() {
            var numX = Math.floor(Math.random() * (boardWidth / squareWidth)) * squareWidth;
            var numY = Math.floor(Math.random() * (boardHeight / squareHeight)) * squareHeight;

            // check for collision
            if (checkForCollision(numX, numY)) {
                createFood(); // get new random numbers
            } else {
                food.x = numX;
                food.y = numY;
            }
        }

        // function to add-on to snake
        function addToSnake(x, y) {
            snake.unshift({ 'x': x, 'y': y });
        }

        // function to check for collision with food/snake
        function checkForCollision(x, y) {
            var results = false;

            // check for previous food position
            if (food.x === x && food.y === y) {
                results = true;
            }

            // check snake positions
            for (var i = 0; i < snake.length; i++) {
                if (snake[i].x === x && snake[i].y === y) {
                    results = true;
                    break;
                }
            }

            return results;
        }

        // function to update the position of the snake
        function update() {

            // check direction
            var offsetX = 0;
            var offsetY = 0;
            switch (direction) {
                case 'left':
                    offsetX = -squareWidth;
                    break;
                case 'right':
                    offsetX = squareWidth;
                    break;
                case 'up':
                    offsetY = -squareHeight;
                    break;
                case 'down':
                    offsetY = squareHeight;
                    break;
            }

            // check the tail of snake and add offset
            var x = snake[0].x + offsetX;
            var y = snake[0].y + offsetY;

            // check for x boundary
            if (x >= boardWidth) {
                x = 0;
            } else if (x < 0) {
                x = boardWidth - squareWidth;
            }

            // check for y boundary
            if (y >= boardHeight) {
                y = 0;
            } else if (y < 0) {
                y = boardHeight - squareHeight;
            }

            // check if catch food
            if (x === food.x && y === food.y) {
                score += 100;
                createFood();
            } else if (checkForCollision(x, y)) { // check for collisions
                gameover = true;
                clearInterval(loop);
                return;
            } else {
                snake.pop(); // remove first item of snake
            }
            addToSnake(x, y);
        }

        // function to handle keyboard presses
        function checkForArrowKeys(event) {
            event = event || window.event;

            // defensive check
            if (event == undefined || event.keyCode == undefined) {
                return;
            }

            // update direction depending on arrow key pressed
            var oppositeDirection = null;
            switch (event.keyCode) {
                case 37:
                    oppositeDirection = 'right';
                    direction = (direction == oppositeDirection) ? oppositeDirection : 'left';
                    break;
                case 38:
                    oppositeDirection = 'down';
                    direction = (direction == oppositeDirection) ? oppositeDirection : 'up';
                    break;
                case 39:
                    oppositeDirection = 'left';
                    direction = (direction == oppositeDirection) ? oppositeDirection : 'right';
                    break;
                case 40:
                    oppositeDirection = 'up';
                    direction = (direction == oppositeDirection) ? oppositeDirection : 'down';
                    break;
            }
        }

        // function to render the whole game: food/snake
        function render() {
            // render food
            drawSquare(food.x, food.y, 'red');

            // render snake
            for (var i = 0; i < snake.length; i++) {
                drawSquare(snake[i].x, snake[i].y, 'green');
            }

            // render score
            var $score = document.getElementById('score');
            $score.textContent = score;
        }

        // function to run the game in a giant loop
        function runGameLoop() {
            clearBoard(); // clear/reset the board
            update(); // update the snake positions for the next render
            render(); // render the whole game
        }

    </script>
</body>

</html>